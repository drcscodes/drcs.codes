<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Dr. CS codes Python DB-API</title><meta name=viewport content="width=device-width"><link rel=stylesheet href=https://DrCS.codes/css/syntax.css><link rel=stylesheet href=https://DrCS.codes/css/main.css><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link href=https://DrCS.codes/css/navbar-top-fixed.css rel=stylesheet></head><body><nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark"><a class=navbar-brand href=/data-manipulation>Python DB-API</a>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="navbar-collapse collapse" id=navbarCollapse><ul class="navbar-nav mr-auto"></ul><ul class="navbar-nav pull-right"><li class="nav-item pull-right"><a class=nav-link href=https://DrCS.codes>Dr. CS codes</a></li></ul></div></nav><main role=main class=container><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>Python Database API</h2><div id=outline-text-headline-1 class=outline-text-2><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>Database Programming in Python</h3><div id=outline-text-headline-2 class=outline-text-3><ul><li>DB-API: <a href=https://www.python.org/dev/peps/pep-0249/><a href=https://www.python.org/dev/peps/pep-0249/>https://www.python.org/dev/peps/pep-0249/</a></a></li><li>SQLite3 is built-in: <code>import sqlite3</code></li><li><p>MySQL reguires third-party library</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ conda install pymysql
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>$ python
</span></span><span style=display:flex><span>Python 3.6.0 |Continuum Analytics, Inc.| <span style=color:#f92672>(</span>default, Dec <span style=color:#ae81ff>23</span> 2016, 13:19:00<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>GCC 4.2.1 Compatible Apple LLVM 6.0 <span style=color:#f92672>(</span>clang-600.0.57<span style=color:#f92672>)]</span> on darwin
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#34;help&#34;</span>, <span style=color:#e6db74>&#34;copyright&#34;</span>, <span style=color:#e6db74>&#34;credits&#34;</span> or <span style=color:#e6db74>&#34;license&#34;</span> <span style=color:#66d9ef>for</span> more information.
</span></span><span style=display:flex><span>&gt;&gt;&gt; import pymysql</span></span></code></pre></div></div></li></ul><p>Key point: most database APIs, including Python's DB-API, are simply ways of executing SQL statements and getting the results of SQL statements. You can't use DB-API without knowing SQL.</p></div></div><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>Working With Databases</h3><div id=outline-text-headline-3 class=outline-text-3><ul><li><p>A connection objects represent a connection to a database</p><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>connection <span style=color:#f92672>=</span> pymysql<span style=color:#f92672>.</span>connect(<span style=color:#f92672>...</span>)</span></span></code></pre></div></div></li><li><p>Cursor object is a stateful pointer to a part of the database</p><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>cursor <span style=color:#f92672>=</span> connection<span style=color:#f92672>.</span>cursor()</span></span></code></pre></div></div></li></ul><ul><li><p>SQL Statements are submitted to cursor's <code>execute()</code> method</p><p>– <code>execute</code> returns the number of rows in the statement's result</p><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> cursor<span style=color:#f92672>.</span>execute(<span style=color:#e6db74>&#39;insert into table values (</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>)&#39;</span>, (<span style=color:#e6db74>&#39;field1&#39;</span>, <span style=color:#e6db74>&#39;field2&#39;</span>))
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span></span></span></code></pre></div></div><p>– If the statement was a select, then the cursor points at the first row of the result</p><ul><li>The cursor object is an iterator over the results (preferred method)</li><li><code>fetchall()</code> , <code>fetchone()</code> , etc. return results in Python data structures</li></ul><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> cursor<span style=color:#f92672>.</span>execute(<span style=color:#e6db74>&#39;select * from table where column1 = </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39;</span>, (<span style=color:#e6db74>&#39;field1&#39;</span>))
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#66d9ef>for</span> row <span style=color:#f92672>in</span> cursor: print(row)
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;column1&#39;</span>: <span style=color:#e6db74>&#39;field1&#39;</span>, <span style=color:#e6db74>&#39;column2&#39;</span>: <span style=color:#e6db74>&#39;field&#39;</span><span style=color:#ae81ff>2</span><span style=color:#e6db74>&#39;}</span></span></span></code></pre></div></div></li></ul></div></div><div id=outline-container-headline-4 class=outline-3><h3 id=headline-4>Connecting to a MySQL Database</h3><div id=outline-text-headline-4 class=outline-text-3><p>If you configured your MySQL server without a root password, this will work:</p><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#f92672>import</span> pymysql
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> connection <span style=color:#f92672>=</span> pymysql<span style=color:#f92672>.</span>connect(host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;localhost&#39;</span>,
</span></span><span style=display:flex><span>                                 user<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;root&#39;</span>,
</span></span><span style=display:flex><span>                                 password<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>                                 db<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;pubs&#39;</span>,
</span></span><span style=display:flex><span>                                 charset<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;utf8mb4&#39;</span>,
</span></span><span style=display:flex><span>                                 cursorclass<span style=color:#f92672>=</span>pymysql<span style=color:#f92672>.</span>cursors<span style=color:#f92672>.</span>DictCursor)</span></span></code></pre></div></div><ul><li>Substitute your own root password if you have one</li><li>Notice that the cursor class id <code>DictCursor</code> - pymysql will return rows of dabases as dictionaries</li></ul></div></div><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>Inserting Data into a Database Table</h3><div id=outline-text-headline-5 class=outline-text-3><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> cursor <span style=color:#f92672>=</span> connection<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> cursor<span style=color:#f92672>.</span>execute(<span style=color:#e6db74>&#39;insert into author values (</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>)&#39;</span>, (<span style=color:#ae81ff>10</span>, <span style=color:#e6db74>&#39;Jenny&#39;</span>, <span style=color:#e6db74>&#39;McCarthy&#39;</span>))
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span></span></span></code></pre></div></div><p>To get the primary key of the row you just inserted, use <code>cursor.lastrowid</code>. This is especially helpful for getting the id of an <code>AUTO_INCREMENT</code> primary key.</p></div></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Executing Queries on a MySQL Database</h3><div id=outline-text-headline-6 class=outline-text-3><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> cursor <span style=color:#f92672>=</span> connection<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> query <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;select * from author where last_name = </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> cursor<span style=color:#f92672>.</span>execute(query, (<span style=color:#e6db74>&#39;McCarthy&#39;</span>))
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#66d9ef>for</span> row <span style=color:#f92672>in</span> cursor: print(row)
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;author_id&#39;</span>: <span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;first_name&#39;</span>: <span style=color:#e6db74>&#39;John&#39;</span>, <span style=color:#e6db74>&#39;last_name&#39;</span>: <span style=color:#e6db74>&#39;McCarthy&#39;</span>}
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;author_id&#39;</span>: <span style=color:#ae81ff>10</span>, <span style=color:#e6db74>&#39;first_name&#39;</span>: <span style=color:#e6db74>&#39;Jenny&#39;</span>, <span style=color:#e6db74>&#39;last_name&#39;</span>: <span style=color:#e6db74>&#39;McCarthy&#39;</span>}</span></span></code></pre></div></div><ul><li>In the query string, use placeholders with same syntax as <code>%</code> - based string interpolation</li><li>In call to <code>cursor.execute</code>, supply values for placeholders in a tuple.</li><li>After calling <code>cursor.execute</code>, cursor is an iterator over the result rows.</li></ul></div></div></div></div></main><script src=https://code.jquery.com/jquery-3.2.1.slim.min.js integrity=sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js integrity=sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q crossorigin=anonymous></script>
<script src=../js/bootstrap.min.js></script></body></html>