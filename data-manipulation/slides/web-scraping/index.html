<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Dr. CS codes Web Scraping</title><meta name=viewport content="width=device-width"><link rel=stylesheet href=https://DrCS.codes/css/syntax.css><link rel=stylesheet href=https://DrCS.codes/css/main.css><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link href=https://DrCS.codes/css/navbar-top-fixed.css rel=stylesheet></head><body><nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark"><a class=navbar-brand href=/data-manipulation>Web Scraping</a>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="navbar-collapse collapse" id=navbarCollapse><ul class="navbar-nav mr-auto"></ul><ul class="navbar-nav pull-right"><li class="nav-item pull-right"><a class=nav-link href=https://DrCS.codes>Dr. CS codes</a></li></ul></div></nav><main role=main class=container><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>Web Scraping</h2><div id=outline-text-headline-1 class=outline-text-2><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>Web Scraping</h3><div id=outline-text-headline-2 class=outline-text-3><p>Two ways to mine data from the web</p><ul><li>The hard way, by web scraping</li><li>The easy way, using web service APIs</li></ul><p>Weâ€™ll see examples of both.</p></div></div><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>Web Scraping</h3><div id=outline-text-headline-3 class=outline-text-3><p>Web scraping, a.k.a. screen scraping, means getting data from a web page. Suppose we want to get the current wind data for a city from <a href=http://openweathermap.org/>Open Weather Map</a>.</p><p><img src=weather-city.png alt=weather-city.png title=weather-city.png></p></div></div><div id=outline-container-headline-4 class=outline-3><h3 id=headline-4>What is a Web Page?</h3><div id=outline-text-headline-4 class=outline-text-3><p>A web page is a chunk of text containing HTML code. The browser "renders" the HTML graphically. So web scraping means analyzing text using Python's text processing features.</p><p><img src=weather-city-html.png alt=weather-city-html.png title=weather-city-html.png></p></div></div><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>Finding The Data On the Page</h3><div id=outline-text-headline-5 class=outline-text-3><p>First you need to find the data within the HTML code for a page so you can construct a regex. Your browser's developer features can help you find the data:</p><p><img src=weather-city-devtools.png alt=weather-city-devtools.png title=weather-city-devtools.png></p></div></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Getting the Web Page's HTML Code</h3><div id=outline-text-headline-6 class=outline-text-3><p>To get the HTML code of the web page into a Python string variable that you can play with, use Python's <code>urllib.request</code> module:</p><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> urllib.request
</span></span><span style=display:flex><span><span style=color:#75715e># 2994160 is the city code for Metz, FR</span>
</span></span><span style=display:flex><span>request <span style=color:#f92672>=</span> urllib<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>Request(<span style=color:#e6db74>&#34;http://www.openweathermap.com/city/2994160&#34;</span>)
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> urllib<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>urlopen(request)
</span></span><span style=display:flex><span>page_bytes <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>page_text <span style=color:#f92672>=</span> page_bytes<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span><span style=color:#75715e># page_text is Python str containing the HTML code</span></span></span></code></pre></div></div><p>or with the <a href=http://docs.python-requests.org/en/master/>requests</a> module, which is what we'll use:</p><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span>resp <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;http://www.openweathermap.com/city/2994160&#34;</span>)
</span></span><span style=display:flex><span>resp<span style=color:#f92672>.</span>text <span style=color:#75715e># the text of the web page</span></span></span></code></pre></div></div></div></div><div id=outline-container-headline-7 class=outline-3><h3 id=headline-7>Extracting the Data</h3><div id=outline-text-headline-7 class=outline-text-3><p>Looks like the wind data is in the second <code>&lt;td></code> element after the <code>&lt;div class="weather-widget"></code> tag, following a <code>&lt;td>Wind&lt;/td></code> element. We can play around with the HTML text in the Python REPL. We eventually end up with:</p><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>wind <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;td&gt;Wind&lt;/td&gt;&lt;td&gt;(.+?)&lt;/td&gt;&#39;</span>, page_text<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>))[<span style=color:#ae81ff>0</span>]</span></span></code></pre></div></div><p>Notice that we used a capture group to get the element data.</p></div></div><div id=outline-container-headline-8 class=outline-3><h3 id=headline-8>Aside: Parsing HTML</h3><div id=outline-text-headline-8 class=outline-text-3><p>HTML is context free language, which roughly means that it supports arbitrary nesting of elements. For example, you could have arbitrarily nested <code>div</code> elements with "leaf" elements containing text data, e.g.:</p><div class="src src-html"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span>&gt;some text&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>div</span>&gt;</span></span></code></pre></div></div><p>By the rules of HTML, you could nest <code>div</code> tags as deeply as you want.</p><p>Regular expressions match regular laguages, which don't support arbitrary nesting. So how can we use regexes to "parse" HTML?</p></div></div><div id=outline-container-headline-9 class=outline-3><h3 id=headline-9>Regex Matching in HTML Code</h3><div id=outline-text-headline-9 class=outline-text-3><p>Parsing means scanning the linear sequence of symbols in a string to determine its structure (usually by putting the symbols in a tree).</p><p>We don't need to parse HTML to find data on a web page. While the HTML <strong>language</strong> supports arbitrary nesting, a particular web page will be nested to a particular depth, resulting a simple linear sequence of symbols that we can match with a regular expression.</p></div></div></div></div></main><script src=https://code.jquery.com/jquery-3.2.1.slim.min.js integrity=sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js integrity=sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q crossorigin=anonymous></script>
<script src=../js/bootstrap.min.js></script></body></html>