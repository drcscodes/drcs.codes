<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Dr. CS codes Flask</title><meta name=viewport content="width=device-width"><link rel=stylesheet href=https://DrCS.codes/css/syntax.css><link rel=stylesheet href=https://DrCS.codes/css/main.css><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link href=https://DrCS.codes/css/navbar-top-fixed.css rel=stylesheet></head><body><nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark"><a class=navbar-brand href=/data-manipulation>Flask</a>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="navbar-collapse collapse" id=navbarCollapse><ul class="navbar-nav mr-auto"></ul><ul class="navbar-nav pull-right"><li class="nav-item pull-right"><a class=nav-link href=https://DrCS.codes>Dr. CS codes</a></li></ul></div></nav><main role=main class=container><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>Flask</h2><div id=outline-text-headline-1 class=outline-text-2><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>Flask</h3><div id=outline-text-headline-2 class=outline-text-3><p>Python's built-in web server is nice, but serious web development is done using a web framework. Web frameworks typically provide:</p><ul><li>Routes, which map URLs to server files or Python code</li><li>Templates, which dynamically insert server-side data into pages of HTML</li><li>Authentication and authorization of user names, passwords, permissions</li><li>Sessions, which keep track of a user during a single visit to a site</li><li>and more â€¦</li></ul><p>We'll use a simple Python web framework called <a href=http://flask.pocoo.org/>Flask</a>.</p></div></div><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>Installing Flask</h3><div id=outline-text-headline-3 class=outline-text-3><p>To install Flask, use conda:</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ conda install flask</span></span></code></pre></div></div><p>To check that your Flask installation was successful, import it:</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>&gt;&gt;&gt; import flask</span></span></code></pre></div></div><p>If you get no error messages, you're ready to start developing web applications with Flask.</p></div></div><div id=outline-container-headline-4 class=outline-3><h3 id=headline-4>Hello, Flask!</h3><div id=outline-text-headline-4 class=outline-text-3><p>Download <a href=../code/web/hello_flask.py>hello_flask.py</a> or paste the following into a file named <code>hello_flask.py</code>:</p><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask, request
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> Flask(__name__)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>index</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&lt;h1&gt;Hello, Flask!&lt;/h1&gt;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>run(debug<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)</span></span></code></pre></div></div><p>In the same directory as your <code>hello_flask.py</code> file run:</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ python3 hello_flask.py
</span></span><span style=display:flex><span> * Running on http://127.0.0.1:5000/
</span></span><span style=display:flex><span> * Restarting with reloader</span></span></code></pre></div></div><p>If you see that output, you should be able to visit your web application in your browser at <a href=http://localhost:5000/>http://localhost:5000/</a></p></div></div><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>Initialization</h3><div id=outline-text-headline-5 class=outline-text-3><p>All Flask applications must create an application instance:</p><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> Flask(__name__)</span></span></code></pre></div></div><p>The argument to the Flask constructor is the name of the main module or package of the application. For our web apps it will always be <code>__name__</code>.</p></div></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Routes and View Functions</h3><div id=outline-text-headline-6 class=outline-text-3><p>Routes map URLs that a web site visitor sees in their address bar to a servier side resource. In:</p><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>index</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&lt;h1&gt;Hello, Flask!&lt;/h1&gt;&#34;</span></span></span></code></pre></div></div><ul><li><code>@app.route("/")</code> registers the function below it, in this case index(), as the handler for / (the index, or default page)</li><li><code>@app.route()</code> is an example of a decorator function, which is a special syntax for higher-order functions (functions that take functions as parameters). Don't worry about the details.</li><li><code>index()</code> is an example of a view function.</li><li>The string returned from a view function is sent in the reponse to the client</li></ul></div></div><div id=outline-container-headline-7 class=outline-3><h3 id=headline-7>Dynamic Routes</h3><div id=outline-text-headline-7 class=outline-text-3><p>Add this function to <code>hello_flask.py</code></p><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#34;/user/&lt;name&gt;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>user</span>(name):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&lt;h1&gt;Hello, </span><span style=color:#e6db74>{</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74>!&lt;/h1&gt;&#34;</span></span></span></code></pre></div></div><ul><li><code>/user/</code> is the static part of the route. It must always appear for this view function to be called.</li><li><code>&lt;name></code> is the dynamic part of the route. It may change on each request, or even be absent</li><li><code>&lt;name></code> matches any text that appears after the static part of the route up to the next forward slash</li></ul><p>Stop your hello_flask.py application with CTRL-C and restart it (if necessary), and visit <a href=http://localhost:5000/user/Lionel>http://localhost:5000/user/Lionel</a></p></div></div><div id=outline-container-headline-8 class=outline-3><h3 id=headline-8>Jinja2 Templates</h3><div id=outline-text-headline-8 class=outline-text-3><p>In the previous examples our view functions returned strings that we generated directly in the functions. It's cleaner to use a template engine.</p><ul><li>A template is a text file that has placeholders for data to be inserted</li><li><em>Rendering</em> is the process of replacing the placeholders in a template with values</li><li>Flask uses the <a href=http://jinja.pocoo.org/>Jinja2</a> template engine</li><li>By default, Flask looks for templates in a subdirectory named templates</li></ul><p>Download <a href=../code/web/hello_jinja2.py>hello_jinja2.py</a> and the <a href=../code/web/templates>templates</a> directory.</p></div></div><div id=outline-container-headline-9 class=outline-3><h3 id=headline-9>Template Variables</h3><div id=outline-text-headline-9 class=outline-text-3><p>Here's a simple template (<a href=../code/web/templates/user.html.jinja2>templates/user.html.jinja2</a>):</p><div class="src src-html"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>title</span>&gt;Hello, {{name}}&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>h1</span>&gt;Hello, {{name}}&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;</span></span></code></pre></div></div><p>And a view function that renders it:</p><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/user/&lt;username&gt;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>user</span>(username):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;user.html.jinja2&#39;</span>, name<span style=color:#f92672>=</span>username)</span></span></code></pre></div></div><ul><li>Keyword arguments to render_template specify key-value pairs for substitution in the template</li><li>In this example, every instance of the variable <code>{{name}}</code> in the template is replaced with the value of <code>username</code> from the view function</li></ul></div></div><div id=outline-container-headline-10 class=outline-3><h3 id=headline-10>Control Structures in Templates</h3><div id=outline-text-headline-10 class=outline-text-3><p>Jinja2 supports control structures such as if statements:</p><div class="src src-html"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>{% if user %}
</span></span><span style=display:flex><span>  Hello, {{ user }}!
</span></span><span style=display:flex><span>{% else %}
</span></span><span style=display:flex><span>  Hello, Stranger!
</span></span><span style=display:flex><span>{% endif %}</span></span></code></pre></div></div><p>and for loops:</p><div class="src src-html"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>ul</span>&gt;
</span></span><span style=display:flex><span>  {% for comment in comments %}
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>li</span>&gt;{{ comment }}&lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>  {% endfor %}
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>ul</span>&gt;</span></span></code></pre></div></div></div></div><div id=outline-container-headline-11 class=outline-3><h3 id=headline-11>Complete Example: Gradebook</h3><div id=outline-text-headline-11 class=outline-text-3><p>Download the files and subdirectories in <a href=../code/web/gradebook>gradebook</a>.</p><ul><li>In <code>grades.py</code> the <code>gradebook()</code> view function parses a CSV file from the local file system and passes data to the <code>grades.html.jinja2</code> template</li></ul><div class="src src-python"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#34;/grades/&lt;course&gt;/&lt;term&gt;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>gradebook</span>(course, term):
</span></span><span style=display:flex><span>    file_name <span style=color:#f92672>=</span> course <span style=color:#f92672>+</span> term <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.csv&#34;</span>
</span></span><span style=display:flex><span>    rows <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(file_name, <span style=color:#e6db74>&#34;r&#34;</span>) <span style=color:#66d9ef>as</span> fin:
</span></span><span style=display:flex><span>        reader <span style=color:#f92672>=</span> csv<span style=color:#f92672>.</span>reader(fin)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> record <span style=color:#f92672>in</span> reader:
</span></span><span style=display:flex><span>            rows<span style=color:#f92672>.</span>append(record)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#34;grades.html.jinja2&#34;</span>,
</span></span><span style=display:flex><span>        course<span style=color:#f92672>=</span>course, term<span style=color:#f92672>=</span>term, rows<span style=color:#f92672>=</span>rows)</span></span></code></pre></div></div><ul><li><code>grades.html.jinja2</code> uses nested for loops to populate an HTML table.</li></ul><p>Take a look at the <code>grades.html.jinjs2</code> template. How would it look if we used a <code>csv.DictReader</code>?</p></div></div><div id=outline-container-headline-12 class=outline-3><h3 id=headline-12>Closing Thoughts</h3><div id=outline-text-headline-12 class=outline-text-3><ul><li>Tons more to know about web applications</li><li>You know enough to make simple, yet useful web applications</li><li>You have a big head start for CS 4400</li></ul></div></div></div></div></main><script src=https://code.jquery.com/jquery-3.2.1.slim.min.js integrity=sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js integrity=sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q crossorigin=anonymous></script>
<script src=../js/bootstrap.min.js></script></body></html>