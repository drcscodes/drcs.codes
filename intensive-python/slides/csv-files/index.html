<!doctype html><html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Dr. CS codes CSV Files</title>
<meta name=viewport content="width=device-width">
<link rel=stylesheet href=http://DrCS.codes//css/syntax.css>
<link rel=stylesheet href=http://DrCS.codes//css/main.css>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous>
<link href=http://DrCS.codes//css/navbar-top-fixed.css rel=stylesheet>
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
<a class=navbar-brand href=/intensive-python></a>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="navbar-collapse collapse" id=navbarCollapse>
<ul class="navbar-nav mr-auto">
<li class=nav-item><a class=nav-link href=/intensive-python/getting-started/>Getting Started</a></li>
<li class=nav-item><a class=nav-link href=/intensive-python/lessons/>Lessons</a></li>
</ul>
<ul class="navbar-nav pull-right">
<li class="nav-item pull-right"><a class=nav-link href=http://DrCS.codes/>Dr. CS codes</a></li>
</ul>
</div>
</nav>
<main role=main class=container>
<ul>
<li>CSV Files</li>
</ul>
<p>** &ldquo;Comma&rdquo;-Separated Values Files</p>
<p>Say we have data in a comma-separated values file</p>
<p>#+BEGIN_SRC sh
$ cat capitals.dat # could be .dat, .csv, or anything
Japan,Tokyo
France,Paris
Germany,Berlin
U.S.A.,Washington, D.C
#+END_SRC</p>
<p>Can use line-by-line file reading with the split() function we saw earlier to process comma-separated value files</p>
<p>#+BEGIN_SRC python
$ python</p>
<blockquote>
<blockquote>
<blockquote>
<p>capitals = {} # initialize a dictionary to hold our capitals data
for line in open(&lsquo;capitals.dat&rsquo;, &lsquo;r&rsquo;): # for each line in file
&mldr; k, v = line.split(',') # split into key and value
&mldr; capitals[k] = v # add key:value to dict
&mldr;
Traceback (most recent call last):
File &ldquo;&rdquo;, line 2, in
ValueError: too many values to unpack
#+END_SRC</p>
</blockquote>
</blockquote>
</blockquote>
<p>Why didn&rsquo;t it work?</p>
<p>** CSV Separator Characters</p>
<p>We can troubleshoot in the Python interpreter</p>
<p>#+BEGIN_SRC python</p>
<blockquote>
<blockquote>
<blockquote>
<p>for line in open(&lsquo;capitals.dat&rsquo;, &lsquo;r&rsquo;):
&mldr; print line.split(',')
&mldr;
[&lsquo;Japan&rsquo;, &lsquo;Tokyo\n&rsquo;]
[&lsquo;France&rsquo;, &lsquo;Paris\n&rsquo;]
[&lsquo;Germany&rsquo;, &lsquo;Berlin\n&rsquo;]
[&lsquo;U.S.A.&rsquo;, &lsquo;Washington&rsquo;, ' D.C\n']
#+END_SRC</p>
</blockquote>
</blockquote>
</blockquote>
<p>There&rsquo;s a comma in Washington, D.C. that was taken as a separator So let&rsquo;s change the capitals.dat file to use semicolons as the separators</p>
<p>#+BEGIN_SRC sh
$ cat capitals.dat
Japan;Tokyo
France;Paris
Germany;Berlin
U.S.A.;Washington, D.C
#+END_SRC</p>
<p>** CSV Files in Practice</p>
<p>Now our capitals.dat file is readable as a &ldquo;comma&rdquo;-separated values file</p>
<p>#+BEGIN_SRC python</p>
<blockquote>
<blockquote>
<blockquote>
<p>capitals = {}
for line in open(&lsquo;capitals.dat&rsquo;, &lsquo;r&rsquo;):
&mldr; k, v = line.split(';')
&mldr; capitals[k] = v
&mldr;
capitals
{&lsquo;Japan&rsquo;: ' Tokyo\n', &lsquo;U.S.A.': ' Washington, D.C\n&rsquo;, &lsquo;Germany&rsquo;: &lsquo;Berlin\n&rsquo;, &lsquo;France&rsquo;: ' Paris\n'}
#+END_SRC</p>
</blockquote>
</blockquote>
</blockquote>
<ul>
<li>But the values have leading whitespace and trailing ~\n~ characters from the data file</li>
</ul>
<p>** Manually Cleaning CSV Lines</p>
<ul>
<li>We can make our code more robust with strip(), which removes leading and trailing whitespace and non-printing chars</li>
</ul>
<p>#+BEGIN_SRC python</p>
<blockquote>
<blockquote>
<blockquote>
<p>for line in open(&lsquo;capitals.dat&rsquo;, &lsquo;r&rsquo;):
&mldr; k, v = line.split(';')
&mldr; capitals[k.strip()] = v.strip()
&mldr;
capitals
{&lsquo;Japan&rsquo;: &lsquo;Tokyo&rsquo;, &lsquo;U.S.A.': &lsquo;Washington, D.C&rsquo;, &lsquo;Germany&rsquo;: &lsquo;Berlin&rsquo;, &lsquo;France&rsquo;: &lsquo;Paris&rsquo;}
#+END_SRC</p>
</blockquote>
</blockquote>
</blockquote>
<p>But we don&rsquo;t need to go to this trouble &mldr;</p>
<p>** The csv Module</p>
<p>The best way to process CSV files is with the csv module.</p>
<p>#+BEGIN_SRC python</p>
<blockquote>
<blockquote>
<blockquote>
<p>import csv
scripters = [
&mldr; [&lsquo;Perl&rsquo;, &lsquo;Larry Wall&rsquo;],
&mldr; [&lsquo;Python&rsquo;, &lsquo;Guido Van Rossum&rsquo;],
&mldr; [&lsquo;Ruby&rsquo;, &lsquo;Yukihiro Matsumoto&rsquo;]
&mldr; ]
with open(&lsquo;scripters&rsquo;, &lsquo;wt&rsquo;) as fout:
&mldr; csvout = csv.writer(fout)
&mldr; csvout.writerows(scripters)
&mldr;
^D
$ cat scripters
Perl,Larry Wall
Python,Guido Van Rossum
Ruby,Yukihiro Matsumoto
#+END_SRC</p>
</blockquote>
</blockquote>
</blockquote>
<ul>
<li>The with statement creates a context manager</li>
<li>After the with block ends, the file is automatically closed</li>
</ul>
<p>** Reading CSV Files</p>
<p>We can read our scripters file with</p>
<p>#+BEGIN_SRC python</p>
<blockquote>
<blockquote>
<blockquote>
<p>import csv
with open(&lsquo;scripters&rsquo;, &lsquo;r&rsquo;) as fin:
&mldr; csvin = csv.reader(fin)
&mldr; scripters = [line for line in csvin]
&mldr;
scripters
[[&lsquo;Perl&rsquo;, &lsquo;Larry Wall&rsquo;], [&lsquo;Python&rsquo;, &lsquo;Guido Van Rossum&rsquo;], [&lsquo;Ruby&rsquo;,
&lsquo;Yukihiro Matsumoto&rsquo;]]</p>
</blockquote>
</blockquote>
</blockquote>
<p>#+END_SRC</p>
<p>** Column Headers in CSV Files</p>
<p>Use a DictReader to store the records from the CSV file in a dict.</p>
<p>#+BEGIN_SRC python</p>
<blockquote>
<blockquote>
<blockquote>
<p>import csv
with open(&lsquo;scripters&rsquo;, &lsquo;r&rsquo;) as fin:
&mldr; csvin = csv.DictReader(fin, fieldnames=[&lsquo;langauge&rsquo;, &lsquo;creator&rsquo;])
&mldr; scripters = [line for line in csvin]
&mldr;
scripters
[{&lsquo;creator&rsquo;: &lsquo;Larry Wall&rsquo;, &lsquo;langauge&rsquo;: &lsquo;Perl&rsquo;}, {&lsquo;creator&rsquo;: &lsquo;Guido Van Rossum&rsquo;, &lsquo;langauge&rsquo;: &lsquo;Python&rsquo;}, {&lsquo;creator&rsquo;: &lsquo;Yukihiro Matsumoto&rsquo;, &lsquo;langauge&rsquo;: &lsquo;Ruby&rsquo;}]
#+END_SRC</p>
</blockquote>
</blockquote>
</blockquote>
<p>** Writing Dicts to CSV Files</p>
<p>And we can use a DictWriter to write a CSV file with a header line.</p>
<p>#+BEGIN_SRC python</p>
<blockquote>
<blockquote>
<blockquote>
<p>with open(&lsquo;scripters&rsquo;, &lsquo;w&rsquo;) as fout:
&mldr; csvout = csv.DictWriter(fout, fieldnames=[&lsquo;langauge&rsquo;,
&lsquo;creator&rsquo;])
&mldr; csvout.writeheader()
&mldr; csvout.writerows(scripters)
&mldr;
^D
$ cat scripters
langauge,creator
Perl,Larry Wall
Python,Guido Van Rossum
Ruby,Yukihiro Matsumoto
#+END_SRC</p>
</blockquote>
</blockquote>
</blockquote>
<p>** CSV Details</p>
<p>CSV files can be complex.</p>
<ul>
<li>Different delimiters can be used.</li>
<li>Delimiter characters can appear in fields.</li>
<li>Fields can be surrounded with &ldquo;quotes&rdquo;.</li>
<li>Different operating systems may use different line endings.</li>
</ul>
<p>The CSV module handles all of these issues for you. Read the [[https://docs.python.org/3/library/csv.html][CSV module documentation]] to become familiar with its capabilities.</p>
</main>
<script src=https://code.jquery.com/jquery-3.2.1.slim.min.js integrity=sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js integrity=sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q crossorigin=anonymous></script>
<script src=../js/bootstrap.min.js></script>
</body>
</html>